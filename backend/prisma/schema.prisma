generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

model CustomerBank {
  id                     String                    @id @default(uuid()) @db.Char(36)
  bankCode               String                    @unique @map("bank_code") @db.VarChar(50)
  bankName               String                    @map("bank_name") @db.VarChar(255)
  status                 OrganizationStatus        @default(ACTIVE)
  primaryContactName     String?                   @map("primary_contact_name") @db.VarChar(255)
  primaryContactEmail    String?                   @map("primary_contact_email") @db.VarChar(255)
  primaryContactPhone    String?                   @map("primary_contact_phone") @db.VarChar(50)
  createdAt              DateTime                  @default(now()) @map("created_at")
  updatedAt              DateTime                  @updatedAt @map("updated_at")
  useMachines            Boolean                   @default(true) @map("use_machines")
  pengelolaAssignments   BankPengelolaAssignment[]
  cassettes              Cassette[]
  machines               Machine[]
  warrantyConfigurations WarrantyConfiguration[]
  users                  BankUser[]

  @@index([bankName])
  @@index([primaryContactEmail])
  @@map("customers_banks")
}

model Pengelola {
  id                         String                    @id @default(uuid()) @db.Char(36)
  pengelolaCode              String                    @unique @map("pengelola_code") @db.VarChar(50)
  companyName                String                    @map("company_name") @db.VarChar(255)
  companyAbbreviation        String                    @map("company_abbreviation") @db.VarChar(50)
  businessRegistrationNumber String?                   @map("business_registration_number") @db.VarChar(100)
  address                    String?
  city                       String?                   @db.VarChar(100)
  province                   String?                   @db.VarChar(100)
  primaryContactName         String?                   @map("primary_contact_name") @db.VarChar(255)
  primaryContactEmail        String?                   @map("primary_contact_email") @db.VarChar(255)
  primaryContactPhone        String?                   @map("primary_contact_phone") @db.VarChar(50)
  website                    String?                   @db.VarChar(255)
  status                     OrganizationStatus        @default(ACTIVE)
  notes                      String?
  createdAt                  DateTime                  @default(now()) @map("created_at")
  updatedAt                  DateTime                  @updatedAt @map("updated_at")
  bankAssignments            BankPengelolaAssignment[]
  machines                   Machine[]
  users                      PengelolaUser[]

  @@index([companyName])
  @@map("pengelola")
}

model BankPengelolaAssignment {
  id                     String             @id @default(uuid()) @db.Char(36)
  customerBankId         String             @map("customer_bank_id") @db.Char(36)
  pengelolaId            String             @map("pengelola_id") @db.Char(36)
  contractNumber         String?            @map("contract_number") @db.VarChar(100)
  contractStartDate      DateTime?          @map("contract_start_date") @db.Date
  contractEndDate        DateTime?          @map("contract_end_date") @db.Date
  serviceScope           String?            @map("service_scope")
  assignedBranches       String?            @map("assigned_branches") @db.LongText
  slaResponseTimeHours   Int?               @map("sla_response_time_hours")
  slaResolutionTimeHours Int?               @map("sla_resolution_time_hours")
  status                 OrganizationStatus @default(ACTIVE)
  notes                  String?
  createdAt              DateTime           @default(now()) @map("created_at")
  updatedAt              DateTime           @updatedAt @map("updated_at")
  customerBank           CustomerBank       @relation(fields: [customerBankId], references: [id], onDelete: Cascade)
  pengelola              Pengelola          @relation(fields: [pengelolaId], references: [id], onDelete: Cascade)

  @@unique([customerBankId, pengelolaId])
  @@index([customerBankId])
  @@index([pengelolaId])
  @@index([status])
  @@index([customerBankId, status])
  @@map("bank_pengelola_assignments")
}

model PengelolaUser {
  id                   String                  @id @default(uuid()) @db.Char(36)
  pengelolaId          String                  @map("pengelola_id") @db.Char(36)
  username             String                  @unique @db.VarChar(100)
  email                String                  @unique @db.VarChar(255)
  passwordHash         String                  @map("password_hash") @db.VarChar(255)
  fullName             String                  @map("full_name") @db.VarChar(255)
  phone                String?                 @db.VarChar(50)
  whatsappNumber       String?                 @map("whatsapp_number") @db.VarChar(50)
  role                 PengelolaUserRole       @default(SUPERVISOR)
  employeeId           String?                 @map("employee_id") @db.VarChar(100)
  canCreateTickets     Boolean                 @default(true) @map("can_create_tickets")
  canCloseTickets      Boolean                 @default(false) @map("can_close_tickets")
  canManageMachines    Boolean                 @default(false) @map("can_manage_machines")
  assignedBranches     String?                 @map("assigned_branches") @db.LongText
  status               OrganizationStatus      @default(ACTIVE)
  lastLogin            DateTime?               @map("last_login")
  createdAt            DateTime                @default(now()) @map("created_at")
  updatedAt            DateTime                @updatedAt @map("updated_at")
  cassetteDeliveries   CassetteDelivery[]
  receivedReturns      CassetteReturn[]        @relation("ReturnReceiver")
  pengelola            Pengelola               @relation(fields: [pengelolaId], references: [id], onDelete: Cascade)
  requestedPMs         PreventiveMaintenance[] @relation("PMRequesterPengelola")
  problemTickets       ProblemTicket[]
  twoFactorSecret      String?                 @map("two_factor_secret") @db.VarChar(255)
  twoFactorEnabled     Boolean                 @default(false) @map("two_factor_enabled")
  twoFactorBackupCodes String?                 @map("two_factor_backup_codes") @db.Text

  @@index([pengelolaId])
  @@index([status])
  @@index([role])
  @@index([pengelolaId, status])
  @@index([fullName])
  @@map("pengelola_users")
}

model HitachiUser {
  id                    String                  @id @default(uuid()) @db.Char(36)
  username              String                  @unique @db.VarChar(100)
  email                 String                  @unique @db.VarChar(255)
  passwordHash          String                  @map("password_hash") @db.VarChar(255)
  fullName              String                  @map("full_name") @db.VarChar(255)
  role                  HitachiUserRole         @default(RC_STAFF)
  department            HitachiUserDepartment   @default(REPAIR_CENTER)
  status                OrganizationStatus      @default(ACTIVE)
  lastLogin             DateTime?               @map("last_login")
  createdAt             DateTime                @default(now()) @map("created_at")
  updatedAt             DateTime                @updatedAt @map("updated_at")
  receivedDeliveries    CassetteDelivery[]      @relation("DeliveryReceiver")
  rcPickupConfirmations CassetteReturn[]        @relation("RCPickupConfirmer")
  sentReturns           CassetteReturn[]        @relation("ReturnSender")
  assignedPMs           PreventiveMaintenance[] @relation("PMEngineer")
  cancelledPMs          PreventiveMaintenance[] @relation("PMCanceller")
  completedPMs          PreventiveMaintenance[] @relation("PMCompleter")
  deletedPMs            PreventiveMaintenance[] @relation("PMDeleter")
  requestedPMs          PreventiveMaintenance[] @relation("PMRequesterHitachi")
  deletedRepairTickets  RepairTicket[]          @relation("RepairTicketDeleter")
  repairTickets         RepairTicket[]
  twoFactorSecret       String?                 @map("two_factor_secret") @db.VarChar(255)
  twoFactorEnabled      Boolean                 @default(false) @map("two_factor_enabled")
  twoFactorBackupCodes  String?                 @map("two_factor_backup_codes") @db.Text

  @@index([status])
  @@index([role])
  @@index([fullName])
  @@map("hitachi_users")
}

model BankUser {
  id                   String             @id @default(uuid()) @db.Char(36)
  customerBankId       String             @map("customer_bank_id") @db.Char(36)
  username             String             @unique @db.VarChar(100)
  email                String             @unique @db.VarChar(255)
  passwordHash         String             @map("password_hash") @db.VarChar(255)
  fullName             String             @map("full_name") @db.VarChar(255)
  phone                String?            @db.VarChar(50)
  role                 BankUserRole       @default(VIEWER)
  status               OrganizationStatus @default(ACTIVE)
  lastLogin            DateTime?          @map("last_login")
  createdAt            DateTime           @default(now()) @map("created_at")
  updatedAt            DateTime           @updatedAt @map("updated_at")
  customerBank         CustomerBank       @relation(fields: [customerBankId], references: [id], onDelete: Cascade)
  twoFactorSecret      String?            @map("two_factor_secret") @db.VarChar(255)
  twoFactorEnabled     Boolean            @default(false) @map("two_factor_enabled")
  twoFactorBackupCodes String?            @map("two_factor_backup_codes") @db.Text

  @@index([customerBankId])
  @@index([status])
  @@index([username])
  @@index([email])
  @@index([customerBankId, status])
  @@index([fullName])
  @@map("bank_users")
}

model Machine {
  id                       String                     @id @default(uuid()) @db.Char(36)
  customerBankId           String                     @map("customer_bank_id") @db.Char(36)
  pengelolaId              String?                    @map("pengelola_id") @db.Char(36)
  machineCode              String                     @unique @map("machine_code") @db.VarChar(100)
  modelName                String                     @map("model_name") @db.VarChar(255)
  serialNumberManufacturer String                     @map("serial_number_manufacturer") @db.VarChar(255)
  physicalLocation         String                     @map("physical_location")
  branchCode               String?                    @map("branch_code") @db.VarChar(100)
  city                     String?                    @db.VarChar(100)
  province                 String?                    @db.VarChar(100)
  installationDate         DateTime?                  @map("installation_date") @db.Date
  currentWsid              String?                    @map("current_wsid") @db.VarChar(100)
  status                   MachineStatus              @default(OPERATIONAL)
  notes                    String?
  createdAt                DateTime                   @default(now()) @map("created_at")
  updatedAt                DateTime                   @updatedAt @map("updated_at")
  cassettes                Cassette[]
  identifierHistory        MachineIdentifierHistory[]
  customerBank             CustomerBank               @relation(fields: [customerBankId], references: [id])
  pengelola                Pengelola?                 @relation(fields: [pengelolaId], references: [id])
  problemTickets           ProblemTicket[]

  @@index([customerBankId])
  @@index([pengelolaId])
  @@index([status])
  @@index([branchCode])
  @@index([customerBankId, status])
  @@index([pengelolaId, status])
  @@index([createdAt])
  @@index([serialNumberManufacturer])
  @@index([machineCode])
  @@index([city])
  @@index([currentWsid])
  @@map("machines")
}

model MachineIdentifierHistory {
  id             String         @id @default(uuid()) @db.Char(36)
  machineId      String         @map("machine_id") @db.Char(36)
  identifierType IdentifierType @map("identifier_type")
  oldValue       String?        @map("old_value") @db.VarChar(255)
  newValue       String         @map("new_value") @db.VarChar(255)
  changeReason   String?        @map("change_reason")
  changedBy      String         @map("changed_by") @db.VarChar(255)
  changedAt      DateTime       @default(now()) @map("changed_at")
  machine        Machine        @relation(fields: [machineId], references: [id], onDelete: Cascade)

  @@index([machineId])
  @@index([identifierType])
  @@index([changedAt])
  @@index([machineId, changedAt])
  @@map("machine_identifier_history")
}

model CassetteType {
  id          String           @id @default(uuid()) @db.Char(36)
  typeCode    CassetteTypeCode @unique @map("type_code")
  machineType String           @map("machine_type") @db.VarChar(100)
  description String?
  createdAt   DateTime         @default(now()) @map("created_at")
  updatedAt   DateTime         @updatedAt @map("updated_at")
  cassettes   Cassette[]

  @@map("cassette_types")
}

model Cassette {
  id                    String                 @id @default(uuid()) @db.Char(36)
  serialNumber          String                 @unique @map("serial_number") @db.VarChar(100)
  cassetteTypeId        String                 @map("cassette_type_id") @db.Char(36)
  customerBankId        String                 @map("customer_bank_id") @db.Char(36)
  status                CassetteStatus         @default(OK)
  usageType             CassetteUsageType?     @map("usage_type")
  machineId             String?                @map("machine_id") @db.Char(36)
  notes                 String?
  replacedCassetteId    String?                @map("replaced_cassette_id") @db.Char(36)
  replacementTicketId   String?                @map("replacement_ticket_id") @db.Char(36)
  markedBrokenBy        String?                @map("marked_broken_by") @db.Char(36)
  createdAt             DateTime               @default(now()) @map("created_at")
  updatedAt             DateTime               @updatedAt @map("updated_at")
  deliveries            CassetteDelivery[]
  returns               CassetteReturn[]
  cassetteType          CassetteType           @relation(fields: [cassetteTypeId], references: [id])
  customerBank          CustomerBank           @relation(fields: [customerBankId], references: [id])
  machine               Machine?               @relation(fields: [machineId], references: [id])
  replacedCassette      Cassette?              @relation("CassetteReplacement", fields: [replacedCassetteId], references: [id])
  replacementFor        Cassette[]             @relation("CassetteReplacement")
  replacementTicket     ProblemTicket?         @relation("ReplacementTicket", fields: [replacementTicketId], references: [id])
  pmCassetteDetails     PMCassetteDetail[]
  problemTickets        ProblemTicket[]        @relation("CassetteProblemTickets")
  repairTickets         RepairTicket[]
  ticketCassetteDetails TicketCassetteDetail[]

  @@index([customerBankId])
  @@index([machineId])
  @@index([status])
  @@index([cassetteTypeId])
  @@index([customerBankId, status])
  @@index([machineId, status])
  @@index([createdAt])
  @@index([replacedCassetteId])
  @@index([replacementTicketId])
  @@map("cassettes")
}

model RepairTicket {
  id                  String                    @id @default(uuid()) @db.Char(36)
  cassetteId          String                    @map("cassette_id") @db.Char(36)
  soTicketId          String?                   @map("so_ticket_id") @db.Char(36)
  reportedIssue       String                    @map("reported_issue")
  receivedAtRc        DateTime                  @map("received_at_rc")
  repairedBy          String?                   @map("repaired_by") @db.Char(36)
  repairActionTaken   String?                   @map("repair_action_taken")
  partsReplaced       String?                   @map("parts_replaced") @db.LongText
  qcPassed            Boolean?                  @map("qc_passed")
  completedAt         DateTime?                 @map("completed_at")
  diagnosingStartAt   DateTime?                 @map("diagnosing_start_at")
  repairStartAt       DateTime?                 @map("repair_start_at")
  otherPartsReplaced  String?                   @map("other_parts_replaced") @db.LongText
  status              RepairTicketStatus        @default(RECEIVED)
  type                PreventiveMaintenanceType @default(ROUTINE)
  notes               String?
  warrantyType        WarrantyType?             @map("warranty_type")
  warrantyPeriodDays  Int?                      @map("warranty_period_days")
  warrantyStartDate   DateTime?                 @map("warranty_start_date")
  warrantyEndDate     DateTime?                 @map("warranty_end_date")
  warrantyClaimed     Boolean                   @default(false) @map("warranty_claimed")
  warrantyClaimCount  Int                       @default(0) @map("warranty_claim_count")
  isWarrantyRepair    Boolean                   @default(false) @map("is_warranty_repair")
  originalRepairId    String?                   @map("original_repair_id") @db.Char(36)
  warrantyClaimReason String?                   @map("warranty_claim_reason")
  deletedAt           DateTime?                 @map("deleted_at")
  deletedBy           String?                   @map("deleted_by") @db.Char(36)
  createdAt           DateTime                  @default(now()) @map("created_at")
  updatedAt           DateTime                  @updatedAt @map("updated_at")
  cassette            Cassette                  @relation(fields: [cassetteId], references: [id])
  soTicket            ProblemTicket?            @relation("RepairToSOTicket", fields: [soTicketId], references: [id])
  deleter             HitachiUser?              @relation("RepairTicketDeleter", fields: [deletedBy], references: [id])
  originalRepair      RepairTicket?             @relation("WarrantyClaim", fields: [originalRepairId], references: [id])
  warrantyClaims      RepairTicket[]            @relation("WarrantyClaim")
  repairer            HitachiUser?              @relation(fields: [repairedBy], references: [id])

  @@index([soTicketId])
  @@index([cassetteId, status])
  @@index([receivedAtRc])
  @@index([status])
  @@index([repairedBy])
  @@index([qcPassed])
  @@index([completedAt])
  @@index([createdAt])
  @@index([status, receivedAtRc])
  @@index([warrantyType])
  @@index([warrantyEndDate])
  @@index([isWarrantyRepair])
  @@index([originalRepairId])
  @@index([deletedAt])
  @@index([deletedBy], map: "repair_tickets_deleted_by_fkey")
  @@map("repair_tickets")
}

model ProblemTicket {
  id                   String                 @id @default(uuid()) @db.Char(36)
  ticketNumber         String                 @unique @map("ticket_number") @db.VarChar(50)
  cassetteId           String?                @map("cassette_id") @db.Char(36)
  machineId            String?                @map("machine_id") @db.Char(36)
  reportedBy           String                 @map("reported_by") @db.Char(36)
  title                String                 @db.VarChar(255)
  description          String
  priority             ProblemTicketPriority  @default(MEDIUM)
  status               ProblemTicketStatus    @default(OPEN)
  affectedComponents   String?                @map("affected_components") @db.LongText
  resolutionNotes      String?                @map("resolution_notes")
  wsid                 String?                @map("wsid") @db.VarChar(100)
  errorCode            String?                @map("error_code") @db.VarChar(50)
  deliveryMethod       String?                @map("delivery_method") @db.VarChar(50)
  courierService       String?                @map("courier_service") @db.VarChar(255)
  trackingNumber       String?                @map("tracking_number") @db.VarChar(100)
  repairLocation       String?                @map("repair_location") @db.VarChar(50)
  reportedAt           DateTime               @default(now()) @map("reported_at")
  resolvedAt           DateTime?              @map("resolved_at")
  closedAt             DateTime?              @map("closed_at")
  deletedAt            DateTime?              @map("deleted_at")
  deletedBy            String?                @map("deleted_by") @db.Char(36)
  createdAt            DateTime               @default(now()) @map("created_at")
  updatedAt            DateTime               @updatedAt @map("updated_at")
  cassetteDelivery     CassetteDelivery?
  cassetteReturn       CassetteReturn?
  replacementCassettes Cassette[]             @relation("ReplacementTicket")
  cassette             Cassette?              @relation("CassetteProblemTickets", fields: [cassetteId], references: [id])
  machine              Machine?               @relation(fields: [machineId], references: [id])
  reporter             PengelolaUser          @relation(fields: [reportedBy], references: [id])
  cassetteDetails      TicketCassetteDetail[]
  repairs              RepairTicket[]         @relation("RepairToSOTicket")

  @@index([cassetteId, status])
  @@index([machineId, status])
  @@index([reportedBy])
  @@index([createdAt])
  @@index([status])
  @@index([reportedAt])
  @@index([deletedAt])
  @@index([closedAt])
  @@index([resolvedAt])
  @@index([status, reportedAt])
  @@index([reportedBy, status])
  @@map("problem_tickets")
}

model TicketCassetteDetail {
  id                 String                @id @default(uuid()) @db.Char(36)
  ticketId           String                @map("ticket_id") @db.Char(36)
  cassetteId         String                @map("cassette_id") @db.Char(36)
  title              String                @db.VarChar(255)
  description        String
  priority           ProblemTicketPriority @default(MEDIUM)
  affectedComponents String?               @map("affected_components") @db.LongText
  wsid               String?               @map("wsid") @db.VarChar(100)
  errorCode          String?               @map("error_code") @db.VarChar(50)
  requestReplacement Boolean               @default(false) @map("request_replacement")
  replacementReason  String?               @map("replacement_reason")
  createdAt          DateTime              @default(now()) @map("created_at")
  updatedAt          DateTime              @updatedAt @map("updated_at")
  cassette           Cassette              @relation(fields: [cassetteId], references: [id])
  ticket             ProblemTicket         @relation(fields: [ticketId], references: [id], onDelete: Cascade)

  @@unique([ticketId, cassetteId])
  @@index([ticketId])
  @@index([cassetteId])
  @@index([ticketId, cassetteId])
  @@map("ticket_cassette_details")
}

model CassetteDelivery {
  id                 String        @id @default(uuid()) @db.Char(36)
  ticketId           String        @unique @map("ticket_id") @db.Char(36)
  cassetteId         String        @map("cassette_id") @db.Char(36)
  sentBy             String        @map("sent_by") @db.Char(36)
  shippedDate        DateTime      @map("shipped_date")
  courierService     String?       @map("courier_service") @db.VarChar(255)
  trackingNumber     String?       @map("tracking_number") @db.VarChar(100)
  estimatedArrival   DateTime?     @map("estimated_arrival")
  receivedAtRc       DateTime?     @map("received_at_rc")
  receivedBy         String?       @map("received_by") @db.Char(36)
  notes              String?
  createdAt          DateTime      @default(now()) @map("created_at")
  updatedAt          DateTime      @updatedAt @map("updated_at")
  senderAddress      String?       @map("sender_address")
  senderCity         String?       @map("sender_city") @db.VarChar(100)
  senderContactName  String?       @map("sender_contact_name") @db.VarChar(255)
  senderContactPhone String?       @map("sender_contact_phone") @db.VarChar(50)
  senderPostalCode   String?       @map("sender_postal_code") @db.VarChar(20)
  senderProvince     String?       @map("sender_province") @db.VarChar(100)
  useOfficeAddress   Boolean       @default(false) @map("use_office_address")
  cassette           Cassette      @relation(fields: [cassetteId], references: [id])
  receiver           HitachiUser?  @relation("DeliveryReceiver", fields: [receivedBy], references: [id])
  sender             PengelolaUser @relation(fields: [sentBy], references: [id])
  ticket             ProblemTicket @relation(fields: [ticketId], references: [id], onDelete: Cascade)

  @@index([ticketId])
  @@index([cassetteId])
  @@index([sentBy])
  @@index([receivedBy])
  @@index([shippedDate])
  @@index([receivedAtRc])
  @@index([cassetteId, shippedDate])
  @@map("cassette_deliveries")
}

model CassetteReturn {
  id                  String         @id @default(uuid()) @db.Char(36)
  ticketId            String         @unique @map("ticket_id") @db.Char(36)
  cassetteId          String         @map("cassette_id") @db.Char(36)
  sentBy              String         @map("sent_by") @db.Char(36)
  shippedDate         DateTime       @map("shipped_date")
  courierService      String?        @map("courier_service") @db.VarChar(255)
  trackingNumber      String?        @map("tracking_number") @db.VarChar(100)
  estimatedArrival    DateTime?      @map("estimated_arrival")
  receivedAtPengelola DateTime?      @map("received_at_pengelola")
  receivedBy          String?        @map("received_by") @db.Char(36)
  notes               String?
  createdAt           DateTime       @default(now()) @map("created_at")
  updatedAt           DateTime       @updatedAt @map("updated_at")
  confirmedByRc       String?        @map("confirmed_by_rc") @db.Char(36)
  rcConfirmedAt       DateTime?      @map("rc_confirmed_at")
  rcSignature         String?        @map("rc_signature") @db.Text
  cassette            Cassette       @relation(fields: [cassetteId], references: [id])
  rcConfirmer         HitachiUser?   @relation("RCPickupConfirmer", fields: [confirmedByRc], references: [id])
  receiver            PengelolaUser? @relation("ReturnReceiver", fields: [receivedBy], references: [id])
  sender              HitachiUser    @relation("ReturnSender", fields: [sentBy], references: [id])
  ticket              ProblemTicket  @relation(fields: [ticketId], references: [id], onDelete: Cascade)

  @@index([ticketId])
  @@index([cassetteId])
  @@index([sentBy])
  @@index([receivedBy])
  @@index([shippedDate])
  @@index([receivedAtPengelola])
  @@index([cassetteId, shippedDate])
  @@index([confirmedByRc], map: "cassette_returns_confirmed_by_rc_fkey")
  @@map("cassette_returns")
}

model PreventiveMaintenance {
  id                   String                        @id @default(uuid()) @db.Char(36)
  pmNumber             String                        @unique @map("pm_number") @db.VarChar(50)
  type                 PreventiveMaintenanceType     @default(ROUTINE)
  location             PreventiveMaintenanceLocation @default(PENGELOLA_LOCATION)
  status               PreventiveMaintenanceStatus   @default(SCHEDULED)
  scheduledDate        DateTime                      @map("scheduled_date")
  scheduledTime        String?                       @map("scheduled_time") @db.VarChar(10)
  actualStartDate      DateTime?                     @map("actual_start_date")
  actualEndDate        DateTime?                     @map("actual_end_date")
  duration             Int?
  title                String                        @db.VarChar(255)
  description          String?
  checklist            String?                       @db.LongText
  findings             String?
  actionsTaken         String?                       @map("actions_taken")
  partsReplaced        String?                       @map("parts_replaced") @db.LongText
  recommendations      String?
  nextPmDate           DateTime?                     @map("next_pm_date")
  nextPmInterval       Int?                          @map("next_pm_interval")
  assignedEngineer     String?                       @map("assigned_engineer") @db.Char(36)
  requestedByPengelola String?                       @map("requested_by_pengelola") @db.Char(36)
  requestedByHitachi   String?                       @map("requested_by_hitachi") @db.Char(36)
  requestedByType      String?                       @map("requested_by_type") @db.VarChar(20)
  contactName          String?                       @map("contact_name") @db.VarChar(255)
  contactPhone         String?                       @map("contact_phone") @db.VarChar(50)
  locationAddress      String?                       @map("location_address")
  locationCity         String?                       @map("location_city") @db.VarChar(100)
  locationProvince     String?                       @map("location_province") @db.VarChar(100)
  locationPostalCode   String?                       @map("location_postal_code") @db.VarChar(20)
  notes                String?
  cancelledReason      String?                       @map("cancelled_reason")
  cancelledBy          String?                       @map("cancelled_by") @db.Char(36)
  cancelledAt          DateTime?                     @map("cancelled_at")
  completedBy          String?                       @map("completed_by") @db.Char(36)
  completedAt          DateTime?                     @map("completed_at")
  deletedAt            DateTime?                     @map("deleted_at")
  deletedBy            String?                       @map("deleted_by") @db.Char(36)
  createdAt            DateTime                      @default(now()) @map("created_at")
  updatedAt            DateTime                      @updatedAt @map("updated_at")
  cassetteDetails      PMCassetteDetail[]
  engineer             HitachiUser?                  @relation("PMEngineer", fields: [assignedEngineer], references: [id])
  canceller            HitachiUser?                  @relation("PMCanceller", fields: [cancelledBy], references: [id])
  completer            HitachiUser?                  @relation("PMCompleter", fields: [completedBy], references: [id])
  deleter              HitachiUser?                  @relation("PMDeleter", fields: [deletedBy], references: [id])
  requesterHitachi     HitachiUser?                  @relation("PMRequesterHitachi", fields: [requestedByHitachi], references: [id])
  requesterPengelola   PengelolaUser?                @relation("PMRequesterPengelola", fields: [requestedByPengelola], references: [id])

  @@index([status])
  @@index([scheduledDate])
  @@index([assignedEngineer])
  @@index([requestedByPengelola])
  @@index([requestedByHitachi])
  @@index([type])
  @@index([location])
  @@index([status, scheduledDate])
  @@index([createdAt])
  @@index([pmNumber])
  @@index([deletedAt])
  @@index([cancelledBy], map: "preventive_maintenances_cancelled_by_fkey")
  @@index([completedBy], map: "preventive_maintenances_completed_by_fkey")
  @@index([deletedBy], map: "preventive_maintenances_deleted_by_fkey")
  @@map("preventive_maintenances")
}

model PMCassetteDetail {
  id            String                @id @default(uuid()) @db.Char(36)
  pmId          String                @map("pm_id") @db.Char(36)
  cassetteId    String                @map("cassette_id") @db.Char(36)
  checklist     String?               @db.LongText
  findings      String?
  actionsTaken  String?               @map("actions_taken")
  partsReplaced String?               @map("parts_replaced") @db.LongText
  status        String?               @db.VarChar(50)
  notes         String?
  createdAt     DateTime              @default(now()) @map("created_at")
  updatedAt     DateTime              @updatedAt @map("updated_at")
  cassette      Cassette              @relation(fields: [cassetteId], references: [id])
  pm            PreventiveMaintenance @relation(fields: [pmId], references: [id], onDelete: Cascade)

  @@unique([pmId, cassetteId])
  @@index([cassetteId, status])
  @@index([pmId])
  @@map("pm_cassette_details")
}

model RefreshToken {
  id        String    @id @default(uuid()) @db.Char(36)
  token     String    @unique @db.VarChar(500)
  userId    String    @map("user_id") @db.Char(36)
  userType  String    @map("user_type") @db.VarChar(50)
  expiresAt DateTime  @map("expires_at")
  revoked   Boolean   @default(false)
  revokedAt DateTime? @map("revoked_at")
  createdAt DateTime  @default(now()) @map("created_at")
  updatedAt DateTime  @updatedAt @map("updated_at")

  @@index([userId, userType])
  @@index([token])
  @@index([expiresAt])
  @@map("refresh_tokens")
}

model WarrantyConfiguration {
  id                    String       @id @default(uuid()) @db.Char(36)
  customerBankId        String       @map("customer_bank_id") @db.Char(36)
  warrantyType          WarrantyType @map("warranty_type")
  warrantyPeriodDays    Int          @map("warranty_period_days")
  maxWarrantyClaims     Int?         @default(1) @map("max_warranty_claims")
  unlimitedClaims       Boolean      @default(false) @map("unlimited_claims")
  warrantyExtensionDays Int?         @map("warranty_extension_days")
  requiresApproval      Boolean      @default(false) @map("requires_approval")
  autoApproveFirstClaim Boolean      @default(true) @map("auto_approve_first_claim")
  freeRepairOnWarranty  Boolean      @default(false) @map("free_repair_on_warranty")
  notes                 String?
  isActive              Boolean      @default(true) @map("is_active")
  createdAt             DateTime     @default(now()) @map("created_at")
  updatedAt             DateTime     @updatedAt @map("updated_at")
  customerBank          CustomerBank @relation(fields: [customerBankId], references: [id], onDelete: Cascade)

  @@unique([customerBankId, warrantyType])
  @@index([customerBankId])
  @@index([warrantyType])
  @@index([isActive])
  @@map("warranty_configurations")
}

model SystemConfig {
  id          String   @id @default(uuid()) @db.Char(36)
  key         String   @unique @db.VarChar(100)
  value       String   @db.LongText
  description String?  @db.VarChar(500)
  createdAt   DateTime @default(now()) @map("created_at")
  updatedAt   DateTime @updatedAt @map("updated_at")

  @@map("system_configs")
}

enum OrganizationStatus {
  ACTIVE
  INACTIVE
  SUSPENDED
}

enum MachineStatus {
  OPERATIONAL
  MAINTENANCE
  DECOMMISSIONED
  UNDER_REPAIR
}

enum PengelolaUserRole {
  SUPERVISOR
  ADMIN
}

enum HitachiUserRole {
  SUPER_ADMIN
  RC_MANAGER
  RC_STAFF
}

enum HitachiUserDepartment {
  MANAGEMENT
  REPAIR_CENTER
  LOGISTICS
}

enum BankUserRole {
  VIEWER
}

enum CassetteTypeCode {
  RB
  AB
  URJB
}

enum CassetteStatus {
  OK
  BAD
  IN_TRANSIT_TO_RC
  IN_REPAIR
  READY_FOR_PICKUP
  IN_TRANSIT_TO_PENGELOLA
  SCRAPPED
}

enum CassetteUsageType {
  MAIN
  BACKUP
}

enum RepairTicketStatus {
  RECEIVED
  DIAGNOSING
  ON_PROGRESS
  COMPLETED
  SCRAPPED
}

enum ProblemTicketStatus {
  OPEN
  PENDING_APPROVAL
  APPROVED_ON_SITE
  IN_DELIVERY
  RECEIVED
  IN_PROGRESS
  RESOLVED
  CLOSED
}

enum ProblemTicketPriority {
  LOW
  MEDIUM
  HIGH
  CRITICAL
}

enum IdentifierType {
  WSID
  SERIAL_NUMBER
  BRANCH_CODE
  PENGELOLA_ASSIGNMENT
}

enum PreventiveMaintenanceStatus {
  SCHEDULED
  IN_PROGRESS
  COMPLETED
  CANCELLED
  RESCHEDULED
}

enum PreventiveMaintenanceType {
  ROUTINE
  ON_DEMAND_PENGELOLA
  ON_DEMAND_HITACHI
  EMERGENCY
}

enum PreventiveMaintenanceLocation {
  BANK_LOCATION
  PENGELOLA_LOCATION
  REPAIR_CENTER
}

enum WarrantyType {
  MA
  MS
  IN_WARRANTY
  OUT_WARRANTY
}

model AuditLog {
  id         String   @id @default(uuid()) @db.Char(36)
  entityType String   @map("entity_type") @db.VarChar(50)
  entityId   String   @map("entity_id") @db.Char(36)
  action     String   @db.VarChar(50)
  userId     String   @map("user_id") @db.Char(36)
  userType   String   @map("user_type") @db.VarChar(20)
  oldValue   String?  @map("old_value") @db.LongText
  newValue   String?  @map("new_value") @db.LongText
  changes    String?  @db.LongText
  ipAddress  String?  @map("ip_address") @db.VarChar(45)
  userAgent  String?  @map("user_agent") @db.VarChar(500)
  metadata   String?  @db.LongText
  createdAt  DateTime @default(now()) @map("created_at")

  @@index([entityType, entityId])
  @@index([userId, userType])
  @@index([action])
  @@index([createdAt])
  @@index([entityType, action, createdAt])
  @@map("audit_logs")
}
